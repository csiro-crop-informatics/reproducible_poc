---
title: "A reproducible and reusable publication and analysis workflow"
author:
- Rad Suchecki
- Nathan Watson-Haigh
- Stuart Stephen
- Alex Whan
#subtitle: "Subtitle"
date: "`r format(Sys.time(), '%A, %d %B, %Y')`"
#tags: [nothing, nothingness]
output:
  #pdf_document:
    #default
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    theme: yeti
    highlight: tango
  beamer_presentation:
    toc: true
    slide_level: 2
    highlight: default #specifies the syntax highlighting style. Supported styles include “default”, “tango”, “pygments”, “kate”, “monochrome”, “espresso”, “zenburn”, and “haddock” (specify null to prevent syntax highlighting)
  revealjs::revealjs_presentation:
    theme: sky #“default”, “simple”, “sky”, “beige”, “serif”, “solarized”, “blood”, “moon”, “night”, “black”, “league” or “white”
    highlight: kate # “default”, “tango”, “pygments”, “kate”, “monochrome”, “espresso”, “zenburn”, and “haddock”. Pass null to prevent syntax highlighting.
    center: false #specifies whether you want to vertically center content on slides (this defaults to false).
    transition: slide #"default”, “fade”, “slide”, “convex”, “concave”, “zoom” or “none”.
    incremental: false
    fig_width: 6
    fig_height: 2
    slide_level: 1 #default=2
    width: 1920
    height: 1080
    autosize: true
    css: reveal.css
  slidy_presentation:
    font_adjustment: -1
  ioslides_presentation:
    widescreen: true
    transition: faster

---

# <mark>Towards</mark> a reproducible and reusable publication and analysis workflow

```{r include = FALSE}
#knitr::opts_chunk$set(echo = FALSE) #resets defaults
library(viridis) #load required libs here
```

# Two-column Layout

.pull-left[
- a bullet
- another bullet
]

.pull-right[
- a bullet
- another bullet
]

----

## BioKanga

- A suite of bioinformatics tools developed at CSIRO.
- [https://github.com/csiro-crop-informatics/biokanga](https://github.com/csiro-crop-informatics/biokanga)

- Aim:
  * evaluation of BioKanga's sequence alignment module vs state-of-the-art tools
  * turn-key reproducibility


----

## Modular workflow
- we developed a modular workflow using ~~two popular automation frameworks, Snakemake and~~ [Nextflow](https://www.nextflow.io/)

- Individual tasks are executed in Cloud or HPC environment using dedicated, ~~lightweight~~ (Docker/Singularity) containers.
- Raw data is acquired from a public sources, processed and analysed.
- Final document including dynamically generated figures and tables is compiled from R Markdown <strike> or LaTeX/knitr </strike>.

----

## [Nextflow](https://www.nextflow.io/)

* Promises
  * Portability
  * Scalability
  * Reproducibility


* Features
  * Separation of pipeline logic from compute
  * Syntax is a superset of Groovy
  * Polyglot
    * mixing scripting languages


----

```{bash, echo = FALSE}
dot -Tpng -Gsize=9,6.6\! -Gdpi=100 -odoc/flowchart_small.png doc/flowchart.dot
```

[![Flowchart](doc/flowchart_small.png)](doc/flowchart.png)

----

## Pipeline logic

* Primarily definitions of processes, each with well defined input and output channels

```{bash, comment=''}
cat main.nf
```

----

## Compute profiles 

* __Implemented:__
  - `standard` i.e. local/interactive assuming all software available
  - `slurm`
  - `modules`
  - `docker`
  - `singularity`
  - `ec2`
* __Upcoming:__ `k8s`, `awsbatch`

Some of the profiles are intended to be used in concert, e.g. 

```{bash, eval = FALSE}
nextflow run main.nf -profile slurm,modules
```

----


## Modules

* Required modules are defined separately and explicitly for each process

```{bash, comment=''}
cat conf/modules.config
```

* Unfortunately, these are compute environment specific
* On the up-side - updating these should be all that is required to run the pipeline on a different SLURM cluster

----

## Containers

* Required containers are defined separately and explicitly for each process
* Available on docker hub
  * Used both by `docker` and `singularity`
  * Always specify version tag

```{bash, comment=''}
cat conf/containers.config
```

----

## 


----

## Further Work

* More systematic evaluation of BioKanga alignment module vs other tools
  * At default settings
  * Exploration of parameter space, optimisation
* Refinement of document generation
  * R Markdown not as flexible as advertised
    * Could the generation of report, slides in various formats 
* Evaluation of Nextflow against Snakemake
